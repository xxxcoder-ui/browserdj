<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=0, shrink-to-fit=yes">
    <title>Browser DJ Mixer</title>
    <link rel="stylesheet" href="./stylesheets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="./stylesheets/style.css">
    <script type="text/javascript" src="./javascripts/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="./javascripts/jquery-ui-10.0.2.min.js"></script>
    <script type="text/javascript" src="./stylesheets/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./javascripts/d3.v3.min.js"></script>
    <script type="text/javascript" src="./javascripts/canvasLCD.js"></script>
    <script type="text/javascript" src="./javascripts/base64-binary.js"></script>
    <script type="text/javascript" src="./javascripts/browserdj.js"></script>
    <link rel="stylesheet" href="./stylesheets/style.css">
  </head>
  <body>
    <div class="row-fluid">
      <div id="box" class="span12">
        <div id="box_disp" class="row inbox">
          <div id="box_lcd" class="row inbox">
            <div class="span6">
              <canvas id="canvasLCD1" class="lcd"></canvas>
              <marquee>Music Mix ðŸŽ¶ Please Add Music With "Load"</marquee>
            </div>
            <div class="span6">
              <canvas id="canvasLCD2" class="lcd"></canvas>
              <marquee>Music Mix ðŸŽ¶ Please Add Music With "Load"</marquee>
            </div>
          </div>
          <div id="box_eq" class="row inbox">
            <div class="span6">
              <div id="viz1" class="viz"></div>
            </div>
            <div class="span6">
              <div id="viz2" class="viz"></div>
            </div>
          </div>
        </div>
        <div id="box_mixer" class="row inbox">
          <div class="span2">
            <p>3D-PAN </p>
            <div id="panner1Y" class="sl"></div>
            <p id="panner1Y_display" class="disptext">0</p>
            <div id="panner1X" class="sl"></div>
            <p id="panner1X_display" class="disptext">0</p>
          </div>
          <div class="span1">
            <p>SPD</p>
            <div id="playspeed_slider1" class="sl"></div>
            <p id="playspeed_display1" class="disptext">1</p>
          </div>
          <div class="span1">
            <p>HPF</p>
            <div id="highpass1" class="sl"></div>
            <p id="highpass_display1" class="disptext">0</p>
          </div>
          <div class="span1">
            <p>LPF </p>
            <div id="lowpass1" class="sl"></div>
            <p id="lowpass_display1" class="disptext">30000</p>
          </div>
          <div class="span1">
            <p>VOL </p>
            <div id="playvolume_slider1" class="sl"></div>
            <p id="playvolume_display1" class="disptext">1</p>
          </div>
          <div id="volB" class="span1">
            <p>VOL</p>
            <div id="playvolume_slider2" class="sl"></div>
            <p id="playvolume_display2" class="disptext">1</p>
          </div>
          <div class="span1">
            <p>LPF</p>
            <div id="lowpass2" class="sl"></div>
            <p id="lowpass_display2" class="disptext">30000</p>
          </div>
          <div class="span1">
            <p>HPF</p>
            <div id="highpass2" class="sl"></div>
            <p id="highpass_display2" class="disptext">0</p>
          </div>
          <div class="span1">
            <p>SPD</p>
            <div id="playspeed_slider2" class="sl"></div>
            <p id="playspeed_display2" class="disptext">1</p>
          </div>
          <div class="span2">
            <p>3D-PAN </p>
            <div id="panner2Y" class="sl"></div>
            <p id="panner2Y_display" class="disptext">0</p>
            <div id="panner2X" class="sl"></div>
            <p id="panner2X_display" class="disptext">0</p>
          </div>
        </div>
        <div id="box_play" class="row inbox">
          <div id="box_play1" class="span4">
            <ul class="navi">
              <li style="display:none">
                <input id="input_file_track1" type="file" accept="*">
              </li>
              <li class="navi_small"><a href="#" id="button_open_track1" class="icon_home">Load</a></li>
              <li class="navi_small"><a href="#" id="stop1" class="icon_location">Stop</a></li>
              <li><a href="#" id="play1" class="icon_home">Play</a></li>
            </ul>
          </div>
          <div class="span4">
            <div id="box_crossfader" class="inbox">
              <div id="crossfader" class="sl"> </div>
            </div>
            <p id="crossfader_display">0</p>
            <div id="waveform">
  <!-- the waveform will be rendered here -->
</div>
<script src="https://unpkg.com/wavesurfer.js@7"></script>
<script src="https://unpkg.com/wavesurfer.js@7/dist/plugins/spectrogram.esm.js"></script>
<script type="module">
import spectrogram from 'public/spectrogram.ts'
import WaveSurfer from 'public/wave.js'
import WaveSurfer from 'https://cdn.jsdelivr.net/npm/wavesurfer.js@7/dist/wavesurfer.esm.js'


  
// Web Audio example

import WaveSurfer from 'wave.js'

// Create your own media element
const audio = new Audio()
audio.controls = true
audio.src = './public/sample.mp3'

// Create a WaveSurfer instance and pass the media element
const wavesurfer = WaveSurfer.create({
  container: document.body,
  waveColor: 'rgb(200, 0, 200)',
  progressColor: 'rgb(100, 0, 100)',
  media: audio, // <- this is the important part
})

// Optionally, add the audio to the page to see the controls
document.body.appendChild(audio)

// Now, create a Web Audio equalizer

// Create Web Audio context
const audioContext = new AudioContext()

// Define the equalizer bands
const eqBands = [32, 64, 125, 250, 500, 1000, 2000, 4000, 8000, 16000]

// Create a biquad filter for each band
const filters = eqBands.map((band) => {
  const filter = audioContext.createBiquadFilter()
  filter.type = band <= 32 ? 'lowshelf' : band >= 16000 ? 'highshelf' : 'peaking'
  filter.gain.value = Math.random() * 40 - 20
  filter.Q.value = 1 // resonance
  filter.frequency.value = band // the cut-off frequency
  return filter
})

// Connect the audio to the equalizer
audio.addEventListener(
  'canplay',
  () => {
    // Create a MediaElementSourceNode from the audio element
    const mediaNode = audioContext.createMediaElementSource(audio)

    // Connect the filters and media node sequentially
    const equalizer = filters.reduce((prev, curr) => {
      prev.connect(curr)
      return curr
    }, mediaNode)

    // Connect the filters to the audio output
    equalizer.connect(audioContext.destination)
  },
  { once: true },
)

// Create a vertical slider for each band
const container = document.createElement('p')
filters.forEach((filter) => {
  const slider = document.createElement('input')
  slider.type = 'range'
  slider.orient = 'vertical'
  slider.style.appearance = 'slider-vertical'
  slider.style.width = '8%'
  slider.min = -40
  slider.max = 40
  slider.value = filter.gain.value
  slider.step = 0.1
  slider.oninput = (e) => (filter.gain.value = e.target.value)
  container.appendChild(slider)
})
document.body.appendChild(container)

</script>
          </div>
          <div id="box_play2" class="span4">
            <ul class="navi">
              <li><a id="play2" href="#" class="icon_home">Play</a></li>
              <li class="navi_small"><a id="stop2" href="#" class="icon_location">Stop</a></li>
              <li class="navi_small"><a href="#" id="button_open_track2" class="icon_home">Load</a></li>
              <li style="display:none">
                <input id="input_file_track2" type="file" accept="*">
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
